-- MySQL Workbench Forward Engineering





-- -----------------------------------------------------
-- Schema cachacaria_adm
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema cachacaria_adm
-- -----------------------------------------------------
-- Schema creation for PostgreSQL
CREATE SCHEMA cachacaria_adm;
-- -----------------------------------------------------
-- Table "cachacaria_adm"."categoria"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."categoria" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(45) NOT NULL,
  "ativo" SMALLINT NOT NULL,
  PRIMARY KEY ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."pais"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."pais" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(60) NOT NULL,
  "nome_pt" VARCHAR(60) NOT NULL,
  "sigla" VARCHAR(2) NOT NULL,
  PRIMARY KEY ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."estado"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."estado" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(75) NOT NULL,
  "uf" VARCHAR(2) NULL DEFAULT NULL,
  "ibge" INTEGER NULL DEFAULT NULL,
  "ddd" VARCHAR(50) NULL DEFAULT NULL,
  "idf_pais" INTEGER NOT NULL,
  PRIMARY KEY ("id"),  
  CONSTRAINT "fk_estado_pais1"
    FOREIGN KEY ("idf_pais")
    REFERENCES "cachacaria_adm"."pais" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;
CREATE INDEX "fk_estado_pais1_idx" ON cachacaria_adm."estado" ("idf_pais");

-- -----------------------------------------------------
-- Table "cachacaria_adm"."cidade"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."cidade" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(120) NOT NULL,
  "idf_estado" INTEGER NOT NULL,
  "ibge" INTEGER NULL DEFAULT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_cidade_estado1"
    FOREIGN KEY ("idf_estado")
    REFERENCES "cachacaria_adm"."estado" ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."sabor"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."sabor" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(60) NOT NULL,
  "ativo" SMALLINT NOT NULL,
  " codigobarras" VARCHAR(30) NULL DEFAULT NULL,
  PRIMARY KEY ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."unidade"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."unidade" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(45) NOT NULL,
  PRIMARY KEY ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."produto"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."produto" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "codigo" INTEGER NOT NULL,
  "descricao" VARCHAR(400) NOT NULL,
  "ativo" SMALLINT NOT NULL DEFAULT 1,
  "temcomposicao" SMALLINT NOT NULL DEFAULT 1,
  "preco" DOUBLE PRECISION NULL DEFAULT 0,
  "capacidade_ml" DOUBLE PRECISION NULL,
  "custo" DOUBLE PRECISION NULL DEFAULT 0,
  "estoqueminimo" INTEGER NULL DEFAULT 0,
  "codigoean" CHAR(13) NULL,
  "codigobarras" VARCHAR(45) NULL,
  "dtacadastro" DATE NOT NULL,
  "dtaalteracao" DATE NULL,
  "idf_categoria" INTEGER NOT NULL,
  "idf_sabor" INTEGER NULL,
  "idf_unidade" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_produto_sabor1"
    FOREIGN KEY ("idf_sabor")
    REFERENCES "cachacaria_adm"."sabor" ("id"),
  CONSTRAINT "fk_produto_categoria1"
    FOREIGN KEY ("idf_categoria")
    REFERENCES "cachacaria_adm"."categoria" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_produto_unidade1"
    FOREIGN KEY ("idf_unidade")
    REFERENCES "cachacaria_adm"."unidade" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."lote"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."lote" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "codigo" VARCHAR(45) NOT NULL,
  "dtaproducao" DATE NOT NULL,
  "dtavalidade" DATE NOT NULL,
  "idf_produto" INTEGER NOT NULL,
  "qtdproduzido" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_lote_produto"
    FOREIGN KEY ("idf_produto")
    REFERENCES "cachacaria_adm"."produto" ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."saldo_produto"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."saldo_produto" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "qtdmov" INTEGER NOT NULL,
  "dtamov" DATE NOT NULL,
  "nrodocto" VARCHAR(45) NOT NULL,
  "origemmovimento" VARCHAR(45) NOT NULL,
  "idf_produto" INTEGER NOT NULL,
  "idf_lote" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_estoque_produto1"
    FOREIGN KEY ("idf_produto")
    REFERENCES "cachacaria_adm"."produto" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_saldo_produto_lote1"
    FOREIGN KEY ("idf_lote")
    REFERENCES "cachacaria_adm"."lote" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;


-- Table "cachacaria_adm"."identificacao"
-- -----------------------------------------------------
CREATE TABLE "cachacaria_adm"."identificacao" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(45) NULL DEFAULT NULL,
  "telefone" VARCHAR(45) NULL DEFAULT NULL,
  "dtanascimento" DATE NULL DEFAULT NULL,
  "cep" VARCHAR(8) NULL DEFAULT NULL,
  "logradouro" VARCHAR(45) NULL DEFAULT NULL,
  "numero" VARCHAR(10) NULL DEFAULT NULL,
  "complemento" VARCHAR(200) NULL DEFAULT NULL,
  "emailcontato" VARCHAR(254) NULL,
  "cpfcnpj" VARCHAR(14) NOT NULL,
  "idf_cidade" INTEGER NOT NULL,
  "cliente" SMALLINT DEFAULT 0,
  "fornecedor" SMALLINT DEFAULT 0,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_identificacao_cidade1"
    FOREIGN KEY ("idf_cidade")
    REFERENCES "cachacaria_adm"."cidade" ("id"));



-- -----------------------------------------------------
-- Table "cachacaria_adm"."composicao"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."composicao" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "qtdcomp" INTEGER NOT NULL,
  "idf_unidade" INTEGER NOT NULL,
  "idf_produto" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_composicao_unidade1"
    FOREIGN KEY ("idf_unidade")
    REFERENCES "cachacaria_adm"."unidade" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_composicao_produto1"
    FOREIGN KEY ("idf_produto")
    REFERENCES "cachacaria_adm"."produto" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."usuario"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."usuario" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(100) NULL,
  "senha" VARCHAR(255) NOT NULL,
  "email" VARCHAR(254) NOT NULL,
  PRIMARY KEY ("id"),
  UNIQUE("email"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."compra_venda"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."compra_venda" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nrodocto" VARCHAR(45) NOT NULL,
  "protocoloaut" CHAR(12) NOT NULL,
  "chevenfe" CHAR(44) NOT NULL,
  "dtaemissao" DATE NOT NULL,
  "dtaentrada" DATE NOT NULL,
  "valorbruto" DOUBLE PRECISION NOT NULL,
  "valorliquido" DOUBLE PRECISION NOT NULL,
  "valorfrete" DOUBLE PRECISION NULL DEFAULT 0,
  "naturezamovimentacao" VARCHAR(45) NOT NULL,
  "idf_identificacao" INTEGER NOT NULL,
  "idf_usuario" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  UNIQUE("chevenfe"),
  CONSTRAINT "fk_movimento_docto_identificacao1"
    FOREIGN KEY ("idf_identificacao")
    REFERENCES "cachacaria_adm"."identificacao" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_compra_venda_usuario1"
    FOREIGN KEY ("idf_usuario")
    REFERENCES "cachacaria_adm"."usuario" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."item_compra_venda"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."item_compra_venda" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "qtdmov" INTEGER NOT NULL,
  "valorunitario" DOUBLE PRECISION NOT NULL,
  "codigolote" VARCHAR(45) NULL,
  "idf_produto" INTEGER NOT NULL,
  "idf_compravenda" INTEGER NOT NULL,
  "idf_lote" INTEGER NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_movimento_prod_produto1"
    FOREIGN KEY ("idf_produto")
    REFERENCES "cachacaria_adm"."produto" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_movimento_prod_movimento_docto1"
    FOREIGN KEY ("idf_compravenda")
    REFERENCES "cachacaria_adm"."compra_venda" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_item_compra_venda_lote1"
    FOREIGN KEY ("idf_lote")
    REFERENCES "cachacaria_adm"."lote" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."producao"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."producao" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nroordemproducao" VARCHAR(45) NOT NULL,
  "dtaproducao" DATE NOT NULL,
  "dtavalidade" DATE NOT NULL,
  "qtdproduzida" INTEGER NOT NULL,
  "custoproducao" DOUBLE PRECISION NOT NULL,
  "codigolote" VARCHAR(45) NOT NULL,
  "idf_produto" INTEGER NOT NULL,
  "idf_usuario" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_producao_produto1"
    FOREIGN KEY ("idf_produto")
    REFERENCES "cachacaria_adm"."produto" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_producao_usuario1"
    FOREIGN KEY ("idf_usuario")
    REFERENCES "cachacaria_adm"."usuario" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."item_producao"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."item_producao" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "qtdnecessidade" INTEGER NOT NULL,
  "qtdrequisitado" INTEGER NOT NULL,
  "qtdsaldo" INTEGER NOT NULL,
  "idf_produto" INTEGER NOT NULL,
  "idf_producao" INTEGER NOT NULL,
  "idf_lote" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_item_producao_produto1"
    FOREIGN KEY ("idf_produto")
    REFERENCES "cachacaria_adm"."produto" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_item_producao_producao1"
    FOREIGN KEY ("idf_producao")
    REFERENCES "cachacaria_adm"."producao" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_item_producao_lote1"
    FOREIGN KEY ("idf_lote")
    REFERENCES "cachacaria_adm"."lote" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."maquinario"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."maquinario" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(200) NOT NULL,
  "dataaquisicao" DATE NOT NULL,
  PRIMARY KEY ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."tipo_manutencao"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."tipo_manutencao" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(100) NULL,
  PRIMARY KEY ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."manutencao_maquinario"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."manutencao_maquinario" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "datamanutencao" DATE NOT NULL,
  "proximamanutencao" DATE NOT NULL,
  "descricao" VARCHAR(400) NOT NULL,
  "custo" DOUBLE PRECISION NOT NULL,
  "obersvacao" VARCHAR(400) NULL,
  "idf_tipomanutencao" INTEGER NOT NULL,
  "idf_maquinario" INTEGER NOT NULL,
  "idf_usuario" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_manutencao_maquinario_tipo_manutencao1"
    FOREIGN KEY ("idf_tipomanutencao")
    REFERENCES "cachacaria_adm"."tipo_manutencao" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_manutencao_maquinario_maquinario1"
    FOREIGN KEY ("idf_maquinario")
    REFERENCES "cachacaria_adm"."maquinario" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT "fk_manutencao_maquinario_usuario1"
    FOREIGN KEY ("idf_usuario")
    REFERENCES "cachacaria_adm"."usuario" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."condicao_utensilio"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."condicao_utensilio" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(45) NOT NULL,
  PRIMARY KEY ("id"))
;


-- -----------------------------------------------------
-- Table "cachacaria_adm"."utensilios"
-- -----------------------------------------------------
CREATE TABLE  "cachacaria_adm"."utensilios" (
  "id" INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "nome" VARCHAR(100) NOT NULL,
  "dataaquisicao" DATE NOT NULL,
  "qtd" INTEGER NOT NULL,
  "idf_condicao_utensilio" INTEGER NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "fk_utensilios_condicao_utensilio1"
    FOREIGN KEY ("idf_condicao_utensilio")
    REFERENCES "cachacaria_adm"."condicao_utensilio" ("id")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
;

-- Índices criados separadamente
-- Índices criados separadamente (corrigidos)

-- Índices criados separadamente (corrigidos)

CREATE INDEX "fk_cidade_estado1_idx" ON cachacaria_adm."cidade" ("idf_estado");
CREATE INDEX "fk_produto_sabor1_idx" ON cachacaria_adm."produto" ("idf_sabor");
CREATE INDEX "fk_produto_categoria1_idx" ON cachacaria_adm."produto" ("idf_categoria");
CREATE INDEX "fk_produto_unidade1_idx" ON cachacaria_adm."produto" ("idf_unidade");
CREATE INDEX "fk_lote_produto_idx" ON cachacaria_adm."lote" ("idf_produto");
CREATE INDEX "fk_estoque_produto1_idx" ON cachacaria_adm."saldo_produto" ("idf_produto");
CREATE INDEX "fk_saldo_produto_lote1_idx" ON cachacaria_adm."saldo_produto" ("idf_lote");
CREATE INDEX "fk_identificacao_cidade1_idx" ON cachacaria_adm."identificacao" ("idf_cidade");
CREATE INDEX "fk_composicao_unidade1_idx" ON cachacaria_adm."composicao" ("idf_unidade");
CREATE INDEX "fk_composicao_produto1_idx" ON cachacaria_adm."composicao" ("idf_produto");
CREATE INDEX "email_unique" ON cachacaria_adm."usuario" ("email");
CREATE INDEX "chevenfe_unique" ON cachacaria_adm."compra_venda" ("chevenfe");
CREATE INDEX "fk_movimento_docto_identificacao1_idx" ON cachacaria_adm."compra_venda" ("idf_identificacao");
CREATE INDEX "fk_compra_venda_usuario1_idx" ON cachacaria_adm."compra_venda" ("idf_usuario");
CREATE INDEX "fk_movimento_prod_produto1_idx" ON cachacaria_adm."item_compra_venda" ("idf_produto");
CREATE INDEX "fk_movimento_prod_movimento_docto1_idx" ON cachacaria_adm."item_compra_venda" ("idf_compravenda");
CREATE INDEX "fk_item_compra_venda_lote1_idx" ON cachacaria_adm."item_compra_venda" ("idf_lote");
CREATE INDEX "fk_producao_produto1_idx" ON cachacaria_adm."producao" ("idf_produto");
CREATE INDEX "fk_producao_usuario1_idx" ON cachacaria_adm."producao" ("idf_usuario");
CREATE INDEX "fk_item_producao_produto1_idx" ON cachacaria_adm."item_producao" ("idf_produto");
CREATE INDEX "fk_item_producao_producao1_idx" ON cachacaria_adm."item_producao" ("idf_producao");
CREATE INDEX "fk_item_producao_lote1_idx" ON cachacaria_adm."item_producao" ("idf_lote");
CREATE INDEX "fk_manutencao_maquinario_tipo_manutencao1_idx" ON cachacaria_adm."manutencao_maquinario" ("idf_tipomanutencao");
CREATE INDEX "fk_manutencao_maquinario_maquinario1_idx" ON cachacaria_adm."manutencao_maquinario" ("idf_maquinario");
CREATE INDEX "fk_manutencao_maquinario_usuario1_idx" ON cachacaria_adm."manutencao_maquinario" ("idf_usuario");
CREATE INDEX "fk_utensilios_condicao_utensilio1_idx" ON cachacaria_adm."utensilios" ("idf_condicao_utensilio");
